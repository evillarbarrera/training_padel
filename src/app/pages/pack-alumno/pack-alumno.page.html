<ion-content [fullscreen]="true">

  <!-- Hero Header -->
  <div class="header-nike">
    <div class="header-overlay"></div>
    <div class="header-content">
      <h1 class="header-title">Adquirir Pack</h1>
      <p class="header-sub">Entrena con los mejores coaches</p>
    </div>
  </div>

  <!-- Coach Filter (Premium) -->
  <div class="filter-section animate-up">
    <div class="nike-card-filter">
      <ion-icon name="funnel-outline" slot="start"></ion-icon>
      <ion-select placeholder="Filtrar por Coach" [(ngModel)]="selectedEntrenador" (ionChange)="filtrarPacks()"
        interface="popover" toggleIcon="chevron-down-outline">
        <ion-select-option *ngFor="let entrenador of entrenadores" [value]="entrenador.id">
          {{ entrenador.nombre }}
        </ion-select-option>
      </ion-select>
    </div>

    <!-- Location Filter -->
    <div class="nike-card-filter animate-up"
      style="margin-top: 10px; flex-direction: column; align-items: stretch; gap: 0;">
      <ion-item lines="none" class="location-toggle" style="--background: transparent; --padding-start: 0;">
        <ion-icon name="location-outline" slot="start" style="margin-right: 10px;"></ion-icon>
        <ion-label style="font-weight: 600;">Ubicar m√°s cercanos</ion-label>
        <ion-toggle slot="end" [(ngModel)]="useLocation" (ionChange)="toggleLocation()"></ion-toggle>
      </ion-item>

      <div class="radius-control" *ngIf="useLocation"
        style="padding-top: 10px; border-top: 1px solid #f2f2f7; margin-top: 5px;">
        <div class="radius-header" style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span style="font-size: 12px; color: #8e8e93;">Radio de b√∫squeda</span>
          <span class="radius-val" style="font-size: 12px; font-weight: 800; color: var(--ion-color-primary);">{{
            searchRadius }} km</span>
        </div>
        <ion-range min="5" max="100" step="5" [value]="searchRadius" (ionChange)="onRadiusChange($event)"
          style="padding: 0;">
        </ion-range>
      </div>

      <div class="loading-location" *ngIf="isLoadingLocation"
        style="display: flex; justify-content: center; gap: 10px; padding: 10px; color: #666; font-size: 12px;">
        <ion-spinner name="crescent" style="width: 16px; height: 16px;"></ion-spinner>
        <span>Localizando...</span>
      </div>
    </div>
  </div>

  <!-- Packs List -->
  <div class="dashboard-container">
    <div class="packs-list">

      <div class="nike-card horizontal-pack-card animate-up" *ngFor="let pack of packsPaginados; let i = index"
        [style.animation-delay]="(i * 0.05) + 's'" [class.pack-completo]="isPackCompleto(pack)">
        <div class="card-media">
          <img [src]="pack.imagen || '/assets/mod-packs.jpg'" class="pack-img" />
          <!-- Badge estado grupal -->
          <ng-container *ngIf="isPackGrupal(pack)">
            <span class="estado-badge" [ngClass]="getEstadoGrupal(pack)">
              {{ getEstadoBadge(pack) }} {{ getEstadoGrupal(pack) | uppercase }}
            </span>
          </ng-container>
        </div>

        <div class="card-content-main">
          <div class="pack-header">
            <h3>{{ pack.nombre }}</h3>
            <span class="price-tag">${{ pack.precio }}</span>
          </div>

          <div class="distance-badge" *ngIf="pack.distancia" style="margin-bottom: 10px; display: inline-block;">
            <span
              style="background: rgba(var(--ion-color-primary-rgb), 0.1); color: var(--ion-color-primary); font-size: 11px; font-weight: 700; padding: 4px 8px; border-radius: 6px;">
              üìç A {{ pack.distancia }} km
            </span>
          </div>

          <p class="pack-desc">{{ pack.descripcion }}</p>

          <!-- Info grupal si aplica -->
          <ng-container *ngIf="isPackGrupal(pack)">
            <div class="grupo-info">
              <span class="cupos-badge">üë• {{ getCuposDisplay(pack) }} cupos</span>
              <span *ngIf="pack.categoria" class="categoria-badge">{{ pack.categoria }}</span>
            </div>
          </ng-container>

          <div class="pack-footer">
            <div class="coach-info">
              <ion-icon name="person-circle-outline"></ion-icon>
              <span>{{ pack.entrenador_nombre }}</span>
            </div>

            <ion-button class="buy-button" (click)="comprarPack(pack)" [disabled]="isPackCompleto(pack)">
              {{ isPackCompleto(pack) ? 'Lleno' : 'Elegir' }}
            </ion-button>
          </div>
        </div>
      </div>

    </div>

    <!-- Pagination (Nike Style) -->
    <div class="pagination-container animate-fade" *ngIf="totalPages.length > 1">
      <div class="pagination-row">
        <button *ngFor="let p of totalPages" class="page-dot" [class.active]="page === p" (click)="setPage(p)">
          {{ p }}
        </button>
      </div>
    </div>
  </div>

  <!-- Back FAB -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button class="nike-fab back-fab" (click)="goToHome()">
      <ion-icon name="chevron-back-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>

<!-- MODAL -->